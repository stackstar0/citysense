<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RegeneraX - Real-Time Environmental Intelligence</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .metric-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }

    .metric-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .status-online {
      color: #10b981;
    }

    .status-warning {
      color: #f59e0b;
    }

    .status-critical {
      color: #ef4444;
    }

    .weather-icon {
      font-size: 2rem;
    }
  </style>
</head>

<body class="bg-gray-100 min-h-screen">
  <!-- Header -->
  <header class="bg-white shadow-sm border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <div class="flex items-center">
          <h1 class="text-3xl font-bold text-gray-900">RegeneraX</h1>
          <span class="ml-3 px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded-full">
            Environmental Intelligence
          </span>
        </div>
        <div class="flex items-center space-x-4">
          <div class="text-sm text-gray-500">
            Last Updated: <span id="lastUpdated">--</span>
          </div>
          <div class="flex items-center">
            <div class="w-3 h-3 bg-green-500 rounded-full mr-2 animate-pulse"></div>
            <span class="text-sm font-medium text-gray-700">Live</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Weather Overview -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Current Weather Conditions</h2>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="text-center">
          <div class="weather-icon mb-2">üå°Ô∏è</div>
          <div class="text-2xl font-bold text-gray-900" id="temperature">--¬∞C</div>
          <div class="text-sm text-gray-500">Temperature</div>
        </div>
        <div class="text-center">
          <div class="weather-icon mb-2">üíß</div>
          <div class="text-2xl font-bold text-gray-900" id="humidity">--%</div>
          <div class="text-sm text-gray-500">Humidity</div>
        </div>
        <div class="text-center">
          <div class="weather-icon mb-2">üí®</div>
          <div class="text-2xl font-bold text-gray-900" id="windSpeed">-- m/s</div>
          <div class="text-sm text-gray-500">Wind Speed</div>
        </div>
        <div class="text-center">
          <div class="weather-icon mb-2">üå¨Ô∏è</div>
          <div class="text-2xl font-bold text-gray-900" id="aqi">--</div>
          <div class="text-sm text-gray-500">Air Quality Index</div>
        </div>
      </div>
    </div>

    <!-- Environmental Metrics Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
      <!-- Air Quality -->
      <div class="metric-card rounded-lg p-6 text-white">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Air Quality</h3>
          <span class="text-2xl">üå¨Ô∏è</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="airQualityScore">--</div>
        <div class="text-sm opacity-90" id="airQualityStatus">Calculating...</div>
        <div class="mt-4">
          <div class="text-xs opacity-75">PM2.5: <span id="pm25Level">--</span> Œºg/m¬≥</div>
          <div class="text-xs opacity-75">NO2: <span id="no2Level">--</span> Œºg/m¬≥</div>
        </div>
      </div>

      <!-- Climate Comfort -->
      <div class="metric-card rounded-lg p-6 text-white">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Climate Comfort</h3>
          <span class="text-2xl">üå°Ô∏è</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="comfortScore">--</div>
        <div class="text-sm opacity-90" id="comfortStatus">Calculating...</div>
        <div class="mt-4">
          <div class="text-xs opacity-75">Heat Index: <span id="heatIndex">--</span>¬∞C</div>
          <div class="text-xs opacity-75">Thermal Stress: <span id="thermalStress">--</span></div>
        </div>
      </div>

      <!-- Energy Efficiency -->
      <div class="metric-card rounded-lg p-6 text-white">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Energy Efficiency</h3>
          <span class="text-2xl">‚ö°</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="energyScore">--</div>
        <div class="text-sm opacity-90" id="energyTrend">Calculating...</div>
        <div class="mt-4">
          <div class="text-xs opacity-75">Avg Consumption: <span id="avgConsumption">--</span> kWh</div>
        </div>
      </div>

      <!-- Water Quality -->
      <div class="metric-card rounded-lg p-6 text-white">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Water Quality</h3>
          <span class="text-2xl">üíß</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="waterQuality">--</div>
        <div class="text-sm opacity-90" id="waterStatus">Calculating...</div>
        <div class="mt-4">
          <div class="text-xs opacity-75">Usage Efficiency: <span id="waterEfficiency">--</span>%</div>
        </div>
      </div>

      <!-- Biodiversity -->
      <div class="metric-card rounded-lg p-6 text-white">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Biodiversity</h3>
          <span class="text-2xl">üåø</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="biodiversityScore">--</div>
        <div class="text-sm opacity-90" id="biodiversityStatus">Calculating...</div>
        <div class="mt-4">
          <div class="text-xs opacity-75">Vegetation Health: <span id="vegetationHealth">--</span>%</div>
        </div>
      </div>

      <!-- Carbon Metrics -->
      <div class="metric-card rounded-lg p-6 text-white">
        <div class="flex items-center justify-between mb-4">
          <h3 class="text-lg font-semibold">Carbon Impact</h3>
          <span class="text-2xl">üå±</span>
        </div>
        <div class="text-3xl font-bold mb-2" id="carbonScore">--</div>
        <div class="text-sm opacity-90" id="carbonStatus">Calculating...</div>
        <div class="mt-4">
          <div class="text-xs opacity-75">CO2 Equivalent: <span id="co2Equivalent">--</span> ppm</div>
        </div>
      </div>
    </div>

    <!-- IoT Sensors Status -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">IoT Sensor Network</h2>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="sensorGrid">
        <!-- Sensors will be populated here -->
      </div>
    </div>

    <!-- Climate Recommendations -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Climate-Responsive Design Recommendations</h2>
      <div id="recommendationsContainer">
        <div class="text-center py-8 text-gray-500">
          Loading recommendations...
        </div>
      </div>
    </div>

    <!-- Environmental Trends Chart -->
    <div class="bg-white rounded-lg shadow-sm p-6">
      <h2 class="text-xl font-semibold text-gray-900 mb-4">Environmental Trends (24 Hours)</h2>
      <div class="h-96">
        <canvas id="environmentalChart"></canvas>
      </div>
    </div>
  </main>

  <script>
    let environmentalChart;
    let lastUpdateTime = null;

    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', function () {
      initializeChart();
      fetchData();

      // Update data every 30 seconds
      setInterval(fetchData, 30000);
    });

    function initializeChart() {
      const ctx = document.getElementById('environmentalChart').getContext('2d');
      environmentalChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [
            {
              label: 'Temperature (¬∞C)',
              data: [],
              borderColor: 'rgb(239, 68, 68)',
              backgroundColor: 'rgba(239, 68, 68, 0.1)',
              tension: 0.4
            },
            {
              label: 'Humidity (%)',
              data: [],
              borderColor: 'rgb(59, 130, 246)',
              backgroundColor: 'rgba(59, 130, 246, 0.1)',
              tension: 0.4
            },
            {
              label: 'Air Quality Index',
              data: [],
              borderColor: 'rgb(16, 185, 129)',
              backgroundColor: 'rgba(16, 185, 129, 0.1)',
              tension: 0.4
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              position: 'top',
            }
          }
        }
      });
    }

    async function fetchData() {
      try {
        // Fetch all data in parallel
        const [weatherResponse, metricsResponse, sensorsResponse, recommendationsResponse] = await Promise.all([
          fetch('/api/weather-data'),
          fetch('/api/environmental-metrics'),
          fetch('/api/iot-sensors'),
          fetch('/api/climate-recommendations')
        ]);

        const weatherData = await weatherResponse.json();
        const metricsData = await metricsResponse.json();
        const sensorsData = await sensorsResponse.json();
        const recommendationsData = await recommendationsResponse.json();

        updateWeatherDisplay(weatherData);
        updateMetricsDisplay(metricsData);
        updateSensorsDisplay(sensorsData);
        updateRecommendationsDisplay(recommendationsData);
        updateChart(weatherData, metricsData);

        // Update last updated time
        document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();

      } catch (error) {
        console.error('Error fetching data:', error);
      }
    }

    function updateWeatherDisplay(data) {
      if (!data || !data.temperature) return;

      document.getElementById('temperature').textContent = `${data.temperature.toFixed(1)}¬∞C`;
      document.getElementById('humidity').textContent = `${data.humidity.toFixed(0)}%`;
      document.getElementById('windSpeed').textContent = `${data.wind_speed.toFixed(1)} m/s`;
      document.getElementById('aqi').textContent = data.air_quality_index ? data.air_quality_index.toFixed(0) : '--';
    }

    function updateMetricsDisplay(data) {
      if (!data || !data.air_quality) return;

      // Air Quality
      const airQuality = data.air_quality;
      document.getElementById('airQualityScore').textContent = airQuality.overall_aqi.toFixed(0);
      document.getElementById('airQualityStatus').textContent = getAirQualityStatus(airQuality.overall_aqi);
      document.getElementById('pm25Level').textContent = airQuality.pm25_level.toFixed(1);
      document.getElementById('no2Level').textContent = airQuality.no2_level.toFixed(1);

      // Climate Comfort
      const comfort = data.climate_comfort;
      document.getElementById('comfortScore').textContent = comfort.comfort_score.toFixed(0);
      document.getElementById('comfortStatus').textContent = comfort.thermal_stress;
      document.getElementById('heatIndex').textContent = comfort.heat_index.toFixed(1);
      document.getElementById('thermalStress').textContent = comfort.thermal_stress;

      // Energy Efficiency
      const energy = data.energy_efficiency;
      document.getElementById('energyScore').textContent = energy.efficiency_score.toFixed(0);
      document.getElementById('energyTrend').textContent = `Trend: ${energy.consumption_trend}`;
      document.getElementById('avgConsumption').textContent = energy.avg_consumption.toFixed(2);

      // Water Quality
      const water = data.water_metrics;
      document.getElementById('waterQuality').textContent = water.quality_index.toFixed(0);
      document.getElementById('waterStatus').textContent = water.contamination_risk;
      document.getElementById('waterEfficiency').textContent = water.usage_efficiency.toFixed(0);

      // Biodiversity
      const bio = data.biodiversity_indicators;
      document.getElementById('biodiversityScore').textContent = bio.species_diversity.toFixed(0);
      document.getElementById('biodiversityStatus').textContent = getBiodiversityStatus(bio.species_diversity);
      document.getElementById('vegetationHealth').textContent = bio.vegetation_health.toFixed(0);

      // Carbon Metrics
      const carbon = data.carbon_metrics;
      document.getElementById('carbonScore').textContent = carbon.carbon_intensity.toFixed(2);
      document.getElementById('carbonStatus').textContent = getCarbonStatus(carbon.carbon_intensity);
      document.getElementById('co2Equivalent').textContent = carbon.co2_equivalent.toFixed(0);
    }

    function updateSensorsDisplay(data) {
      const sensorGrid = document.getElementById('sensorGrid');
      sensorGrid.innerHTML = '';

      for (const [sensorId, readings] in Object.entries(data)) {
        if (readings.length === 0) continue;

        const latestReading = readings[readings.length - 1];
        const sensorCard = createSensorCard(sensorId, latestReading);
        sensorGrid.appendChild(sensorCard);
      }
    }

    function createSensorCard(sensorId, reading) {
      const div = document.createElement('div');
      div.className = 'bg-gray-50 rounded-lg p-4 border';

      const statusClass = reading.quality_score > 0.8 ? 'status-online' :
        reading.quality_score > 0.6 ? 'status-warning' : 'status-critical';

      div.innerHTML = `
                <div class="flex items-center justify-between mb-2">
                    <h4 class="font-medium text-gray-900">${sensorId}</h4>
                    <div class="w-3 h-3 rounded-full ${statusClass === 'status-online' ? 'bg-green-500' : statusClass === 'status-warning' ? 'bg-yellow-500' : 'bg-red-500'}"></div>
                </div>
                <div class="text-sm text-gray-600">
                    <div>Type: ${reading.sensor_type}</div>
                    <div>Value: ${reading.value.toFixed(2)} ${reading.unit}</div>
                    <div>Quality: ${(reading.quality_score * 100).toFixed(0)}%</div>
                </div>
            `;

      return div;
    }

    function updateRecommendationsDisplay(recommendations) {
      const container = document.getElementById('recommendationsContainer');

      if (!recommendations || recommendations.length === 0) {
        container.innerHTML = '<div class="text-center py-8 text-gray-500">No recommendations available</div>';
        return;
      }

      container.innerHTML = recommendations.map(rec => `
                <div class="border rounded-lg p-4 mb-4 ${getPriorityBorderClass(rec.priority)}">
                    <div class="flex items-start justify-between mb-2">
                        <h3 class="font-semibold text-gray-900">${rec.title}</h3>
                        <span class="px-2 py-1 text-xs font-medium rounded ${getPriorityBadgeClass(rec.priority)}">
                            ${rec.priority.toUpperCase()}
                        </span>
                    </div>
                    <p class="text-gray-600 mb-3">${rec.description}</p>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-gray-500">
                        <div><strong>Impact Score:</strong> ${(rec.impact_score * 100).toFixed(0)}%</div>
                        <div><strong>Timeframe:</strong> ${rec.implementation_timeframe}</div>
                        <div><strong>Cost:</strong> ${rec.cost_estimate}</div>
                    </div>
                    <div class="mt-3">
                        <strong class="text-sm text-gray-700">Design Principles:</strong>
                        <div class="flex flex-wrap gap-2 mt-1">
                            ${rec.design_principles.map(principle =>
        `<span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded">${principle}</span>`
      ).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
    }

    function updateChart(weatherData, metricsData) {
      if (!weatherData || !metricsData) return;

      const now = new Date().toLocaleTimeString();
      const maxPoints = 20;

      // Add new data point
      environmentalChart.data.labels.push(now);
      environmentalChart.data.datasets[0].data.push(weatherData.temperature);
      environmentalChart.data.datasets[1].data.push(weatherData.humidity);
      environmentalChart.data.datasets[2].data.push(metricsData.air_quality.overall_aqi);

      // Remove old data points
      if (environmentalChart.data.labels.length > maxPoints) {
        environmentalChart.data.labels.shift();
        environmentalChart.data.datasets.forEach(dataset => dataset.data.shift());
      }

      environmentalChart.update('none'); // Update without animation for performance
    }

    // Helper functions
    function getAirQualityStatus(aqi) {
      if (aqi <= 50) return 'Good';
      if (aqi <= 100) return 'Moderate';
      if (aqi <= 150) return 'Unhealthy for Sensitive';
      return 'Unhealthy';
    }

    function getBiodiversityStatus(score) {
      if (score >= 80) return 'Excellent';
      if (score >= 60) return 'Good';
      if (score >= 40) return 'Fair';
      return 'Poor';
    }

    function getCarbonStatus(intensity) {
      if (intensity <= 0.5) return 'Low Impact';
      if (intensity <= 0.8) return 'Moderate Impact';
      return 'High Impact';
    }

    function getPriorityBorderClass(priority) {
      switch (priority) {
        case 'high': return 'border-red-300';
        case 'medium': return 'border-yellow-300';
        case 'low': return 'border-green-300';
        default: return 'border-gray-300';
      }
    }

    function getPriorityBadgeClass(priority) {
      switch (priority) {
        case 'high': return 'bg-red-100 text-red-800';
        case 'medium': return 'bg-yellow-100 text-yellow-800';
        case 'low': return 'bg-green-100 text-green-800';
        default: return 'bg-gray-100 text-gray-800';
      }
    }
  </script>
</body>

</html>